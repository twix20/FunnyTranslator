@model FunnyTranslator.Models.TranslatorViewModel
@{
    ViewBag.Title = "Index";
}

<!-- Cover -->
<div class="d-flex align-items-center py-5 section-aquamarine section-dark cover" style="background-image: url('../../Static/conference/cover.jpg');">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-white mt-5 text-center">
                <h1 class="d-md-none">Funny Translator</h1>
                <h3 class="display-1 d-none d-md-block">Funny Translator</h3>

                <p class="">by Piotr Markiewicz</p>

                <a class="nav-link" href="#translator">
                    <i class="d-block fa fa-angle-down pt-5 fa-3x"></i>
                </a>

            </div>
        </div>
    </div>
</div>
<!-- Parallax section -->
<div id="translator" class="py-5 section-parallax" style="background-image: url('../../Static/conference/venue.jpg');">
    <div class="container my-5 bg-light p-4">
        <form>
            <div class="form-group row">
                <div class="col-md-9">
                    <div class="form-group">
                        <label for="exampleFormControlTextarea1">Text to translate</label>
                        <textarea class="form-control" id="textToTranslateTextArea"></textarea>
                    </div>
                </div>

                <div class="col-md-3 d-flex flex-column justify-content-center">
                    <select id="translateTypeSelect" class="form-control form-control-sm">
                        @foreach (var method in Model.SupportedTranslationMethods)
                        {
                            <option value="@method">@method</option>
                        }
                    </select>
                </div>

            </div>
            <div class="form-group row">
                <div class="col-12 text-center">
                    <a href="#translation-result">
                        <button id="btn-translate" type="button" class="btn btn-primary">Translate!</button>
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- TranslationResult -->
<div class="bg-info" id="translation-result">
</div>

@* TODO: move to translator.js *@
@section scripts {
    
    <script id="success-translation-result-template" type="text/x-custom-template">
        <div class="container-fluid py-5">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h4 class="alert-heading"><b>Well done!</b></h4>
                    <p>You have just translated text to ###TRANSLATION_METHOD###</p>
                    <hr>
                    <p class="mb-0">###TRANSLATED_TEXT###</p>
                </div>
            </div>
        </div>
    </script>

    <script>
        function presentTranslatedText(translationInfo) {
            console.log(translationInfo);

            var template = $('#success-translation-result-template')
                .html()
                .replace(/###TRANSLATION_METHOD###/g, translationInfo.TranslationMethod)
                .replace(/###TRANSLATED_TEXT###/g, translationInfo.TranslatedText);

            
            $('#translation-result').empty().append(template);
        }

        function displayError(error) {
            alert(error);
        }

        $(function() {
            $('#btn-translate').click(function (event) {
                //Button load status
                const $target = $('#btn-translate');
                $target.attr("disabled", true);
                $target.append('<i class="fa fa-spinner fa-pulse"></i>');

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Translate", "Translator")",
                    data: JSON.stringify({
                        'text': $('#textToTranslateTextArea').val(),
                        'translateType': $('#translateTypeSelect').val()
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data) {
                        if (data.IsSuccess)
                        {
                            presentTranslatedText(data.Result);
                        }
                        else
                        {
                            data.Errors.forEach(function(error) {
                                displayError(error);
                            });
                        }
                    },
                    error: function (data) {
                        displayError(data.responseJSON.ErrorMessage);
                    },
                    failure: function (errMsg) {
                        displayError(errMsg);
                    },
                    complete: function (data) {
                        $target.find("i.fa-spinner").remove();
                        $target.attr("disabled", false);
                    }
                });
            });
        });
    </script>
}